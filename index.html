<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta charset="UTF-8" />
<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=	GTM-WRJTD7X2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', '	GTM-WRJTD7X2');
</script>

<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
<title>pixelbuilder2.com</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');

  :root {
    --primary-color: #7f5af0; /* أرجواني */
    --primary-hover: #9d79f8;
    --background-dark: #1a1a2e;
    --background-light: #f0f0ff;
    --text-light: #e0e0ff;
    --text-dark: #222222;
    --shadow-glow: rgba(127, 90, 240, 0.7);
  }

  body {
    margin: 0; padding: 0;
    font-family: 'Cairo', sans-serif;
    background: var(--background-dark);
    color: var(--text-light);
    min-height: 100vh;
    transition: background 0.3s, color 0.3s;
  }
  body.light {
    background: var(--background-light);
    color: var(--text-dark);
  }

  header {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 60px;
    background: #2e2e52;
    border-bottom: 3px solid var(--primary-color);
    box-shadow: 0 0 15px var(--shadow-glow);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    z-index: 999;
    user-select: none;
  }
  body.light header {
    background: #dfe4ff;
    border-color: var(--primary-color);
    box-shadow: 0 0 15px #bbace6;
    color: var(--text-dark);
  }

  .header-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .header-right {
    display: flex;
    align-items: center;
    gap: 15px;
  }
  .logo {
    font-weight: 900;
    font-size: 1.6rem;
    color: var(--primary-color);
    user-select: text;
    text-shadow: 0 0 10px var(--primary-color);
  }
  body.light .logo {
    color: #5b3cc4;
    text-shadow: none;
  }

  .settings-btn {
    background: transparent;
    border: none;
    color: var(--primary-color);
    font-size: 1.6rem;
    cursor: pointer;
    user-select: none;
    transition: color 0.3s;
  }
  body.light .settings-btn {
    color: #5b3cc4;
  }
  .settings-btn:hover {
    color: var(--primary-hover);
  }

  .auth-buttons button {
    background: var(--primary-color);
    border: none;
    color: #f0e9ff;
    padding: 8px 18px;
    border-radius: 20px;
    font-weight: 700;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s, box-shadow 0.3s;
    box-shadow: 0 0 8px var(--primary-color);
  }
  body.light .auth-buttons button {
    background: #a595f9;
    color: var(--text-dark);
    box-shadow: 0 0 8px #a595f9aa;
  }
  .auth-buttons button:hover {
    background: var(--primary-hover);
    box-shadow: 0 0 15px var(--primary-hover);
  }

  nav#navDesktop {
    margin-top: 60px;
    background: #2e2e52;
    border-bottom: 3px solid var(--primary-color);
    box-shadow: 0 0 25px var(--shadow-glow);
    display: flex;
    justify-content: center;
    gap: 18px;
    position: sticky;
    top: 60px;
    z-index: 998;
    padding: 8px 0;
  }
  body.light nav#navDesktop {
    background: #dfe4ff;
    border-color: var(--primary-color);
    box-shadow: 0 0 25px #bbace6;
  }
  nav#navDesktop button {
    background: transparent;
    border: none;
    color: var(--primary-color);
    padding: 14px 26px;
    cursor: pointer;
    font-weight: 800;
    font-size: 1.15rem;
    border-radius: 25px;
    letter-spacing: 0.03em;
    transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
  }
  body.light nav#navDesktop button {
    color: #5b3cc4;
  }
  nav#navDesktop button.active,
  nav#navDesktop button:hover {
    background: var(--primary-color);
    color: #f0e9ff;
    box-shadow: 0 0 20px var(--primary-color);
  }
  body.light nav#navDesktop button.active,
  body.light nav#navDesktop button:hover {
    background: #5b3cc4;
    color: var(--background-light);
    box-shadow: 0 0 20px #a595f9;
  }

  /* قائمة الموبايل */
  .hamburger {
    width: 28px;
    height: 22px;
    display: none;
    flex-direction: column;
    justify-content: space-between;
    cursor: pointer;
  }
  .hamburger div {
    height: 4px;
    background: var(--primary-color);
    border-radius: 3px;
    transition: all 0.3s ease;
  }
  body.light .hamburger div {
    background: #5b3cc4;
  }
  .hamburger.active div:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
  }
  .hamburger.active div:nth-child(2) {
    opacity: 0;
  }
  .hamburger.active div:nth-child(3) {
    transform: rotate(-45deg) translate(6px, -6px);
  }
  nav#navMobile {
    display: none;
    background: #2e2e52;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
    padding: 12px 0;
    position: fixed;
    top: 60px;
    left: 0;
    right: 0;
    z-index: 997;
  }
  body.light nav#navMobile {
    background: #dfe4ff;
  }
  nav#navMobile button {
    background: transparent;
    border: none;
    color: var(--primary-color);
    padding: 14px 24px;
    font-weight: 700;
    cursor: pointer;
    border-radius: 20px;
    font-size: 1rem;
    letter-spacing: 0.02em;
    transition: background-color 0.3s, color 0.3s;
  }
  body.light nav#navMobile button {
    color: #5b3cc4;
  }
  nav#navMobile button.active,
  nav#navMobile button:hover {
    background: var(--primary-color);
    color: #f0e9ff;
    box-shadow: 0 0 15px var(--primary-color);
  }
  body.light nav#navMobile button.active,
  body.light nav#navMobile button:hover {
    background: #5b3cc4;
    color: var(--background-light);
    box-shadow: 0 0 15px #a595f9;
  }

  main {
    margin: 125px auto 40px auto;
    max-width: 900px;
    padding: 0 22px 50px 22px;
    min-height: 70vh;
  }
  main section {
    display: none;
  }
  main section.active {
    display: block;
    animation: fadeIn 0.6s ease forwards;
  }
  @keyframes fadeIn {
    from {opacity: 0;}
    to {opacity: 1;}
  }

  h2 {
    margin-top: 0;
    font-size: 2.3rem;
    margin-bottom: 14px;
    letter-spacing: 0.04em;
  }
  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 700;
    font-size: 1.15rem;
  }

  input[type=text],
  input[type=password],
  textarea,
  select,
  input[type=color] {
    width: 100%;
    padding: 12px 16px;
    margin-bottom: 22px;
    border-radius: 22px;
    border: 2px solid var(--primary-color);
    background: #3a3a6a;
    color: var(--text-light);
    font-size: 1.15rem;
    font-family: 'Cairo', sans-serif;
    resize: vertical;
    transition: border-color 0.3s, background 0.3s, color 0.3s;
    box-shadow: 0 0 15px var(--shadow-glow);
  }
  body.light input[type=text],
  body.light input[type=password],
  body.light textarea,
  body.light select,
  body.light input[type=color] {
    background: #f0f0ff;
    border-color: #a595f9;
    color: var(--text-dark);
    box-shadow: 0 0 15px #a595f9cc;
  }
  input[type=text]:focus,
  input[type=password]:focus,
  textarea:focus,
  select:focus,
  input[type=color]:focus {
    outline: none;
    border-color: var(--primary-hover);
    box-shadow: 0 0 20px var(--primary-hover);
  }
  body.light input[type=text]:focus,
  body.light input[type=password]:focus,
  body.light textarea:focus,
  body.light select:focus,
  body.light input[type=color]:focus {
    border-color: #9d79f8;
    box-shadow: 0 0 20px #9d79f8cc;
  }
  textarea {
    min-height: 100px;
  }

  .btn {
    background: var(--primary-color);
    color: #f0e9ff;
    border: none;
    padding: 14px 36px;
    border-radius: 30px;
    font-size: 1.25rem;
    font-weight: 900;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s, box-shadow 0.3s;
    box-shadow: 0 0 20px var(--primary-color);
  }
  .btn:hover {
    background: var(--primary-hover);
    box-shadow: 0 0 25px var(--primary-hover);
  }
  body.light .btn {
    background: #a595f9;
    color: var(--text-dark);
    box-shadow: 0 0 20px #a595f9;
  }
  body.light .btn:hover {
    background: #9d79f8;
    box-shadow: 0 0 25px #9d79f8;
  }

  .nested-btn {
    padding: 10px 22px;
    font-size: 1rem;
  }

  .help-text {
    margin-top: -12px;
    margin-bottom: 15px;
    font-weight: 700;
    color: #f66;
    min-height: 20px;
    user-select: none;
  }
  body.light .help-text {
    color: #a33;
  }

  /* بطاقة الدعم ملونة */
  .support-card {
    background: linear-gradient(135deg, #7f5af0cc 0%, #b084f5cc 100%);
    padding: 22px 25px;
    border-radius: 20px;
    color: #f0e9ff;
    box-shadow: 0 0 35px #7f5af0bb;
  }
  .support-note {
    font-weight: 800;
    font-size: 1.1rem;
    margin-bottom: 12px;
    user-select: none;
  }
  .support-card textarea {
    background: #5a3fa9cc;
    color: #f0e9ff;
    box-shadow: 0 0 20px #7f5af0cc inset;
    border-color: #a98fff;
  }
  .support-card textarea:focus {
    background: #6a4fffcc;
    border-color: #c2b2ff;
    box-shadow: 0 0 25px #9d79f8cc inset;
  }

  /* إعدادات متقدمة */
  #settingsModal {
    background: #2a2a4e;
    color: #c7c3ff;
    border-radius: 25px;
    box-shadow: 0 0 60px #7f5af0cc;
  }
  @import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');

  .neon-settings-btn {
    font-family: 'Cairo', sans-serif;
    padding: 14px 28px;
    font-size: 18px;
    color: #fff;
    background: #141414;
    border: 2px solid #7f5af0;
    border-radius: 40px;
    box-shadow: 0 0 10px #7f5af0, 0 0 20px #7f5af0, 0 0 30px #2cb67d;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    transition: 0.3s ease;
    position: relative;
    z-index: 1;
    overflow: hidden;
  }

  .neon-settings-btn::before {
    content: "";
    position: absolute;
    top: 0; left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(120deg, transparent, rgba(127, 90, 240, 0.3), transparent);
    transition: 0.5s;
    z-index: 0;
  }

  .neon-settings-btn:hover::before {
    left: 100%;
  }

  .neon-settings-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 20px #7f5af0, 0 0 30px #2cb67d, 0 0 40px #7f5af0;
  }

  .neon-settings-btn i {
    animation: spin 2s linear infinite;
  } 

  /* مساعد ذكي */
  #chat-assistant {
    position: fixed;
    bottom: 20px;
    left: 20px;
    width: 300px;
    max-width: 95vw;
    background: #2e2e52;
    border-radius: 20px;
    box-shadow: 0 0 30px var(--primary-color);
    color: var(--text-light);
    font-family: 'Cairo', sans-serif;
    user-select: none;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    z-index: 9999;
  }
  body.light #chat-assistant {
    background: #dfe4ff;
    color: var(--text-dark);
    box-shadow: 0 0 30px #a595f9;
  }
  #chat-header {
    padding: 14px 20px;
    font-weight: 900;
    font-size: 1.3rem;
    background: var(--primary-color);
    cursor: pointer;
    user-select: none;
    text-align: center;
  }
  body.light #chat-header {
    background: #5b3cc4;
    color: var(--background-light);
  }
  #chat-messages {
    max-height: 280px;
    overflow-y: auto;
    padding: 15px 20px;
    font-size: 1rem;
    flex-grow: 1;
  }
  .chat-msg {
    margin-bottom: 14px;
    padding: 12px 18px;
    border-radius: 18px;
    max-width: 85%;
    line-height: 1.4;
  }
  .chat-msg.user {
    background: #7f5af0cc;
    color: #f0e9ff;
    margin-left: auto;
    box-shadow: 0 0 15px #7f5af0cc;
  }
  body.light .chat-msg.user {
    background: #a595f9cc;
    color: var(--text-dark);
    box-shadow: 0 0 15px #a595f9cc;
  }
  .chat-msg.bot {
    background: #463f6e;
    color: #cccfff;
    margin-right: auto;
  }
  body.light .chat-msg.bot {
    background: #b0b7dc;
    color: #333355;
  }
  #chat-input-container {
    display: flex;
    padding: 12px 20px;
    background: #241f4f;
  }
  body.light #chat-input-container {
    background: #b4b9e5;
  }
  #chat-input {
    flex-grow: 1;
    border: none;
    border-radius: 20px;
    padding: 10px 18px;
    font-size: 1.1rem;
    font-family: 'Cairo', sans-serif;
    outline: none;
    box-shadow: inset 0 0 12px #7f5af0cc;
    color: #f0e9ff;
    background: #463f6e;
  }
  body.light #chat-input {
    background: #d0d5f7;
    color: var(--text-dark);
    box-shadow: inset 0 0 12px #a595f9cc;
  }
  #chat-send-btn {
    margin-left: 14px;
    padding: 10px 22px;
    border: none;
    border-radius: 20px;
    background: var(--primary-color);
    color: #f0e9ff;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    box-shadow: 0 0 15px var(--primary-color);
    transition: background-color 0.3s;
  }
  #chat-send-btn:hover {
    background: var(--primary-hover);
  }
  body.light #chat-send-btn {
    background: #a595f9;
    color: var(--text-dark);
  }
  body.light #chat-send-btn:hover {
    background: #9d79f8;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .hamburger {
      display: flex;
    }
    nav#navDesktop {
      display: none;
    }
    main {
      margin-top: 110px;
      max-width: 95vw;
      padding: 0 15px 40px 15px;
    }
    header {
      justify-content: space-between;
    }
    .header-left {
      gap: 8px;
    }
    .logo {
      font-size: 1.3rem;
    }
    #chat-assistant {
      width: 90vw;
      left: 5vw;
      bottom: 12px;
    }
  }
</style>
</head>
<body>

<header>
  <div class="header-left">
    <button id="openSettings" class="settings-btn" title="⚙️ إعدادات الموقع">⚙️</button>
  </div>
  <div class="logo" aria-label="شعار الموقع">welcom to pixel</div>
  <div class="header-right auth-buttons">
    <button class="login-btn" onclick="switchSection('login')">تسجيل دخول</button>
    <button class="signup-btn" onclick="switchSection('login')">إنشاء حساب</button>
  </div>
  <div class="hamburger" id="hamburgerBtn" aria-label="فتح القائمة الرئيسية" role="button" tabindex="0">
    <div></div><div></div><div></div>
  </div>
</header>

<nav id="navDesktop" aria-label="القائمة الرئيسية">
  <button class="active" onclick="switchSection('create', this)">📦 إنشاء مشروع</button>
  <button onclick="switchSection('edit', this)">✏️ تعديل مشروع</button>
  <button onclick="switchSection('share', this)">🚀 مشاركة مشروع</button>
  <button onclick="switchSection('design', this)">🎨 تصميم المشروع</button>
  <button onclick="switchSection('support', this)">🛠️ المساعدة</button>
</nav>

<nav id="navMobile" class="mobile-menu" aria-label="القائمة الرئيسية">
  <button class="active" onclick="mobileNavClick('create', this)">📦 إنشاء مشروع</button>
  <button onclick="mobileNavClick('edit', this)">✏️ تعديل مشروع</button>
  <button onclick="mobileNavClick('share', this)">🚀 مشاركة مشروع</button>
  <button onclick="mobileNavClick('design', this)">🎨 تصميم المشروع</button>
  <button onclick="mobileNavClick('support', this)">🛠️ المساعدة</button>
</nav>

<main id="mainContent" tabindex="-1">

  <!-- تسجيل دخول / إنشاء حساب -->
  <section id="login" class="active" aria-label="تسجيل الدخول أو إنشاء حساب">
    <h2>تسجيل دخول أو إنشاء حساب</h2>
    <label for="username">اسم المستخدم</label>
    <input type="text" id="username" placeholder="اختر اسم المستخدم" autocomplete="username" />
    <label for="password">كلمة المرور</label>
    <input type="password" id="password" placeholder="كلمة المرور" autocomplete="current-password" />
    <div class="auth-buttons">
      <button class="btn" onclick="login()">تسجيل الدخول</button>
      <button class="btn nested-btn" onclick="signup()">إنشاء حساب</button>
    </div>
    <div id="authMsg" class="help-text" role="alert" aria-live="polite"></div>
  </section>

  <!-- إنشاء مشروع -->
  <section id="create" aria-label="إنشاء مشروع جديد">
    <h2>📦 إنشاء مشروع جديد</h2>
    <label for="projectName">اسم المشروع</label>
    <input type="text" id="projectName" placeholder="أدخل اسم المشروع" />
    <label for="projectDesc">وصف المشروع</label>
    <textarea id="projectDesc" placeholder="وصف مختصر للمشروع..."></textarea>
    <button class="btn" onclick="createProject()">بدء المشروع</button>
    <div id="createMsg" class="help-text" role="alert" aria-live="polite"></div>
  </section>

  <!-- تعديل مشروع -->
  <section id="edit" aria-label="تعديل مشروع">
    <h2>✏️ تعديل مشروع</h2>
    <label for="editProjectId">معرف المشروع</label>
    <input type="text" id="editProjectId" placeholder="أدخل معرف المشروع" />
    <label for="editProjectDesc">تعديل الوصف</label>
    <textarea id="editProjectDesc" placeholder="عدل وصف المشروع هنا"></textarea>
    <button class="btn" onclick="editProject()">حفظ التعديلات</button>
    <div id="editMsg" class="help-text" role="alert" aria-live="polite"></div>
  </section>

  <!-- مشاركة مشروع -->
  <section id="share" aria-label="مشاركة مشروع">
    <h2>🚀 مشاركة مشروعك</h2>
    <label for="shareProjectId">معرف المشروع</label>
    <input type="text" id="shareProjectId" placeholder="أدخل معرف المشروع للمشاركة" />
    <button class="btn" onclick="shareProject()">نسخ رابط المشاركة</button>
    <div id="shareMsg" class="help-text" role="alert" aria-live="polite"></div>
  </section>

  <!-- تصميم المشروع -->
  <section id="design" aria-label="تصميم المشروع">
    <h2>🎨 تصميم المشروع</h2>
    <label for="projectColor">اختر لون التصميم</label>
    <input type="color" id="projectColor" value="#7f5af0" />
    <label for="projectFont">اختر نوع الخط</label>
    <select id="projectFont" aria-label="اختيار الخط">
      <option value="'Cairo', sans-serif">Cairo (افتراضي)</option>
      <option value="'Arial', sans-serif">Arial</option>
      <option value="'Courier New', monospace">Courier New</option>
      <option value="'Tahoma', sans-serif">Tahoma</option>
      <option value="'Times New Roman', serif">Times New Roman</option>
    </select>
    <button class="btn" onclick="applyDesign()">تطبيق التصميم</button>
  </section>

  <!-- قسم المساعدة -->
  <section id="support" aria-label="قسم المساعدة والدعم">
    <h2>🛠️ المساعدة والدعم</h2>
    <div class="support-card" role="region" aria-label="بطاقة الدعم">
      <p class="support-note">يرجى ملء البطاقة إذا كان لديك أي مشكلة في الموقع أو السيرفر.</p>
      <label for="supportMsg">صف مشكلتك أو سؤالك:</label>
      <textarea id="supportMsg" placeholder="اكتب مشكلتك هنا..."></textarea>
      <button class="btn" onclick="sendSupport()">إرسال الطلب</button>
      <p id="supportResp" class="help-text" role="alert" aria-live="polite"></p>
    </div>
  </section>

</main>

<!-- إعدادات متقدمة -->
<div id="settingsModal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle" style="display:none;position:fixed;top:10%;left:50%;transform:translateX(-50%);padding:25px 30px;max-width:320px;z-index:10000;">
  <h3 id="settingsTitle">⚙️ إعدادات الموقع</h3>
  <label for="themeSelect">الوضع (فاتح / داكن):</label>
  <select id="themeSelect" aria-label="اختيار الوضع">
    <option value="dark" selected>داكن</option>
    <option value="light">فاتح</option>
  </select>

  <label for="colorTheme">لون التصميم الرئيسي:</label>
  <input type="color" id="colorTheme" value="#7f5af0" aria-label="اختيار لون التصميم الرئيسي" />

  <label for="zoomRange">تكبير الموقع (%):</label>
  <input type="range" id="zoomRange" min="80" max="130" value="100" step="1" aria-valuemin="80" aria-valuemax="130" aria-valuenow="100" aria-label="تكبير الموقع" />

  <label for="langSelect">اللغة:</label>
  <select id="langSelect" aria-label="اختيار اللغة">
    <option value="ar" selected>العربية</option>
    <option value="en">English</option>
  </select>

  <button id="closeSettingsBtn" class="btn nested-btn" style="width:100%;margin-top:20px;">إغلاق الإعدادات</button>
</div>

<!-- مساعد ذكي -->
<div id="chat-assistant" role="complementary" aria-label="مساعد ذكي">
  <div id="chat-header" tabindex="0" role="button" aria-pressed="false" aria-expanded="false">💡 مساعد ذكي (انقر للفتح/الإغلاق)</div>
  <div id="chat-messages" style="display:none;"></div>
  <div id="chat-input-container" style="display:none;">
    <input type="text" id="chat-input" aria-label="أدخل رسالة للمساعد" autocomplete="off" />
    <button id="chat-send-btn" aria-label="إرسال رسالة">إرسال</button>
  </div>
</div>

<script>
  // تخزين البيانات في localStorage
  function getData() {
    return JSON.parse(localStorage.getItem('projectHubData') || '{"users":[], "projects":[]}');
  }
  function saveData(data) {
    localStorage.setItem('projectHubData', JSON.stringify(data));
  }
  function saveUser(user) {
    localStorage.setItem('projectHubUser', JSON.stringify(user));
  }
  function getUser() {
    return JSON.parse(localStorage.getItem('projectHubUser') || 'null');
  }
  function clearUser() {
    localStorage.removeItem('projectHubUser');
  }

  // تسجيل دخول
  function login() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    const msg = document.getElementById('authMsg');
    if(!username || !password) {
      msg.textContent = "يرجى إدخال اسم المستخدم وكلمة المرور";
      return;
    }
    const data = getData();
    const user = data.users.find(u => u.username === username && u.password === password);
    if(user) {
      saveUser(user);
      msg.textContent = "تم تسجيل الدخول بنجاح";
      switchSection('create');
      updateAuthUI();
    } else {
      msg.textContent = "خطأ في اسم المستخدم أو كلمة المرور";
    }
  }
  // إنشاء حساب
  function signup() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    const msg = document.getElementById('authMsg');
    if(!username || !password) {
      msg.textContent = "يرجى إدخال اسم المستخدم وكلمة المرور";
      return;
    }
    const data = getData();
    if(data.users.find(u => u.username === username)) {
      msg.textContent = "اسم المستخدم موجود مسبقاً";
      return;
    }
    data.users.push({username,password});
    saveData(data);
    saveUser({username,password});
    msg.textContent = "تم إنشاء الحساب وتسجيل الدخول";
    switchSection('create');
    updateAuthUI();
  }
  // تحديث عرض تسجيل الدخول حسب حالة المستخدم
  function updateAuthUI() {
    const user = getUser();
    const authDiv = document.querySelector('.auth-buttons');
    if(user) {
      authDiv.innerHTML = `<span>مرحباً، <strong>${user.username}</strong></span> <button class="btn nested-btn" onclick="logout()">تسجيل خروج</button>`;
    } else {
      authDiv.innerHTML = `<button class="login-btn btn">تسجيل دخول</button> <button class="signup-btn btn nested-btn">إنشاء حساب</button>`;
      document.querySelector('.login-btn').onclick = () => switchSection('login');
      document.querySelector('.signup-btn').onclick = () => switchSection('login');
    }
  }
  function logout() {
    clearUser();
    updateAuthUI();
    switchSection('login');
  }

  // التنقل بين الأقسام
  function switchSection(sectionId, btn) {
    const sections = document.querySelectorAll('main section');
    sections.forEach(s => s.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');
    // تحديث أزرار navDesktop
    if(btn) {
      document.querySelectorAll('#navDesktop button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }
    // تحديث أزرار navMobile
    if(btn && btn.parentElement.id === 'navMobile') {
      document.querySelectorAll('#navMobile button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      // إخفاء القائمة عند اختيار عنصر
      document.getElementById('hamburgerBtn').classList.remove('active');
      document.getElementById('navMobile').style.display = 'none';
    }
    // التركيز على main content للقراءة السريعة
    document.getElementById('mainContent').focus();
  }

  // زر القائمة الموبايل
  const hamburger = document.getElementById('hamburgerBtn');
  const navMobile = document.getElementById('navMobile');
  hamburger.onclick = () => {
    hamburger.classList.toggle('active');
    if(navMobile.style.display === 'flex') {
      navMobile.style.display = 'none';
    } else {
      navMobile.style.display = 'flex';
    }
  };

  function mobileNavClick(sectionId, btn) {
    switchSection(sectionId, btn);
  }

  // إنشاء مشروع
  function createProject() {
    const user = getUser();
    const name = document.getElementById('projectName').value.trim();
    const desc = document.getElementById('projectDesc').value.trim();
    const msg = document.getElementById('createMsg');
    if(!user) {
      msg.textContent = "يجب تسجيل الدخول أولاً";
      return;
    }
    if(!name) {
      msg.textContent = "يرجى إدخال اسم المشروع";
      return;
    }
    const data = getData();
    const id = 'P'+Date.now();
    data.projects.push({id, name, desc, owner: user.username, design: {color:'#7f5af0', font: "'Cairo', sans-serif"}});
    saveData(data);
    msg.textContent = `تم إنشاء المشروع. معرف المشروع: ${id}`;
    document.getElementById('projectName').value = '';
    document.getElementById('projectDesc').value = '';
  }

  // تعديل مشروع
  function editProject() {
    const user = getUser();
    const id = document.getElementById('editProjectId').value.trim();
    const newDesc = document.getElementById('editProjectDesc').value.trim();
    const msg = document.getElementById('editMsg');
    if(!user) {
      msg.textContent = "يجب تسجيل الدخول أولاً";
      return;
    }
    if(!id) {
      msg.textContent = "يرجى إدخال معرف المشروع";
      return;
    }
    const data = getData();
    const project = data.projects.find(p => p.id === id && p.owner === user.username);
    if(!project) {
      msg.textContent = "المشروع غير موجود أو ليس من ضمن مشاريعك";
      return;
    }
    project.desc = newDesc;
    saveData(data);
    msg.textContent = "تم حفظ التعديلات بنجاح";
  }

  // مشاركة مشروع - نسخ رابط (رابط افتراضي فقط)
  function shareProject() {
    const id = document.getElementById('shareProjectId').value.trim();
    const msg = document.getElementById('shareMsg');
    if(!id) {
      msg.textContent = "يرجى إدخال معرف المشروع";
      return;
    }
    const url = `${location.origin}${location.pathname}?project=${encodeURIComponent(id)}`;
    navigator.clipboard.writeText(url).then(() => {
      msg.textContent = `تم نسخ الرابط: ${url}`;
    }).catch(() => {
      msg.textContent = `الرابط: ${url} (نسخ تلقائي لم ينجح)`;
    });
  }

  // تطبيق التصميم على المشروع (معاينة فقط)
  function applyDesign() {
    const color = document.getElementById('projectColor').value;
    const font = document.getElementById('projectFont').value;
    document.documentElement.style.setProperty('--primary-color', color);
    document.body.style.fontFamily = font;
    alert("تم تطبيق التصميم على الصفحة (معاينة فقط)");
  }

  // إرسال طلب الدعم
  function sendSupport() {
    const msg = document.getElementById('supportMsg').value.trim();
    const resp = document.getElementById('supportResp');
    if(!msg) {
      resp.textContent = "يرجى كتابة المشكلة أو السؤال.";
      return;
    }
    resp.textContent = "شكراً لتواصلك، سيتم الرد عليك قريباً.";
    document.getElementById('supportMsg').value = '';
  }

  // إعدادات الموقع (الوضع، اللون، الزوم، اللغة)
  const settingsModal = document.getElementById('settingsModal');
  const openSettingsBtn = document.getElementById('openSettings');
  const closeSettingsBtn = document.getElementById('closeSettingsBtn');
  const themeSelect = document.getElementById('themeSelect');
  const zoomRange = document.getElementById('zoomRange');
  const colorTheme = document.getElementById('colorTheme');
  const langSelect = document.getElementById('langSelect');

  openSettingsBtn.onclick = () => {
    settingsModal.style.display = 'block';
  };
  closeSettingsBtn.onclick = () => {
    settingsModal.style.display = 'none';
  };

  function applyTheme(theme) {
    if(theme === 'light') {
      document.body.classList.add('light');
      document.getElementById('chat-assistant').classList.add('light');
    } else {
      document.body.classList.remove('light');
      document.getElementById('chat-assistant').classList.remove('light');
    }
  }
  themeSelect.onchange = () => {
    applyTheme(themeSelect.value);
  };

  zoomRange.oninput = () => {
    document.body.style.zoom = zoomRange.value +     '%';
  };

  colorTheme.oninput = () => {
    document.documentElement.style.setProperty('--primary-color', colorTheme.value);
  };

  langSelect.onchange = () => {
    alert('تغيير اللغة إلى: ' + langSelect.options[langSelect.selectedIndex].text + '\nهذه خاصية تجريبية في النسخة الحالية.');
  };

  // مساعد ذكي (بسيط جداً)
  const chatHeader = document.getElementById('chat-header');
  const chatMessages = document.getElementById('chat-messages');
  const chatInputContainer = document.getElementById('chat-input-container');
  const chatInput = document.getElementById('chat-input');
  const chatSendBtn = document.getElementById('chat-send-btn');

  chatHeader.onclick = () => {
    const expanded = chatHeader.getAttribute('aria-expanded') === 'true';
    if(expanded) {
      chatMessages.style.display = 'none';
      chatInputContainer.style.display = 'none';
      chatHeader.setAttribute('aria-expanded', 'false');
    } else {
      chatMessages.style.display = 'block';
      chatInputContainer.style.display = 'flex';
      chatHeader.setAttribute('aria-expanded', 'true');
      chatInput.focus();
    }
  };

  function appendMessage(sender, text) {
    const div = document.createElement('div');
    div.classList.add('chat-msg', sender);
    div.textContent = text;
    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  chatSendBtn.onclick = () => {
    const text = chatInput.value.trim();
    if(!text) return;
    appendMessage('user', text);
    chatInput.value = '';

    setTimeout(() => {
      // ردود بسيطة تلقائية
      if(text.includes('مرحبا') || text.includes('أهلًا')) {
        appendMessage('bot', 'مرحباً! كيف يمكنني مساعدتك في مشروعك اليوم؟');
      } else if(text.includes('مساعدة')) {
        appendMessage('bot', 'يمكنك استخدام قسم المساعدة لإرسال مشاكلك أو استفساراتك.');
      } else if(text.includes('شكرًا') || text.includes('شكرا')) {
        appendMessage('bot', 'على الرحب والسعة!');
      } else {
        appendMessage('bot', 'عذراً، لم أفهم طلبك. حاول أن تكون أكثر تحديداً.');
      }
    }, 1000);
  };

  // بداية
  updateAuthUI();

  // تهيئة لتحديد القسم المناسب بناء على رابط مع معرف المشروع (اختياري)
  function initFromUrl() {
    const urlParams = new URLSearchParams(window.location.search);
    const proj = urlParams.get('project');
    if(proj) {
      switchSection('share');
      document.getElementById('shareProjectId').value = proj;
    }
  }
  initFromUrl();

</script>
<script>
// عداد زوار محلي
const visitKey = 'pixelbuilder2_visit_count';
let count = localStorage.getItem(visitKey);
if (!count) count = 0;
count = parseInt(count) + 1;
localStorage.setItem(visitKey, count);

document.addEventListener("DOMContentLoaded", () => {
  const visitDiv = document.createElement("div");
  visitDiv.textContent = `عدد زياراتك للموقع: ${count}`;
  visitDiv.style.position = "fixed";
  visitDiv.style.bottom = "10px";
  visitDiv.style.right = "10px";
  visitDiv.style.background = "#2e2e52";
  visitDiv.style.color = "#fff";
  visitDiv.style.padding = "10px 20px";
  visitDiv.style.borderRadius = "15px";
  visitDiv.style.fontWeight = "bold";
  visitDiv.style.boxShadow = "0 0 10px #7f5af0";
  visitDiv.style.zIndex = 99999;
  document.body.appendChild(visitDiv);
});
</script>

</body>
</html>
